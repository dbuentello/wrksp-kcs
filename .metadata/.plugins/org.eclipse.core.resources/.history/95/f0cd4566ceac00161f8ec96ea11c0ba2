package com.mulesoft.custom.kcs;

import java.util.Map;

import org.mule.api.MuleEventContext;
import org.mule.api.MuleMessage;
import org.mule.api.lifecycle.Callable;
import org.mule.api.transport.PropertyScope;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;

public class JsonDiff implements Callable {

	@Override
	public Object onCall(MuleEventContext eventContext) throws Exception {
		// TODO Auto-generated method stub
		
	    MuleMessage msg = eventContext.getMessage();
	    //String path1 = msg.getPayloadAsString();
	    //String path2 = msg.getProperty("origPayload", PropertyScope.INVOCATION);
	    Map path1 = (Map) msg.getPayload();
	    Map path2 = msg.getProperty("origPayload", PropertyScope.INVOCATION);

	    
		ObjectMapper mapper = new ObjectMapper();
		JsonNode obj1 = mapper.readValues(path1, JsonNode.class);
		JsonNode obj2 = mapper.readValues(path2, JsonNode.class);
		    
		return com.flipkart.zjsonpatch.JsonDiff.asJson(obj1, obj2);
	}

	
}
